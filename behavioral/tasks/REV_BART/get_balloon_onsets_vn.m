% modified by veena to work with OSX BART and KBQUEUE% 12/30/07if ~exist('ntrials'),  fprintf('load the data file first!');  return;end;for t=1:ntrials,    if trial_info(t).finished==0,        ntrials=t-1;        break;    end;end;pay_levels=[0.25];pl=zeros(1,ntrials);bl=pl;explod=pl;tt=pl; npress=pl;control_balloon=3;% model regressors:% accept trials% explosions% rejections% control trialsaccept_times=zeros(1,1);explode_times=zeros(1,1);reject_times=zeros(1,1);control_times=zeros(1,1);accept_ctr=1;reject_ctr=1;explode_ctr=1;control_ctr=1;for t=1:ntrials,	if isempty(trial_info(t).trial_total),		trial_info(t).trial_total=0;	end;  %pl(t)=find(pay_levels==trial_info(t).payoff_level);  bl(t)=trial_info(t).balloon;  et(t)=trial_info(t).explode_trial;  explod(t)=trial_info(t).exploded;  tt(t)=trial_info(t).trial_total;  npress(t)=length(trial_info(t).rt(:,1));  if bl(t)==3,    % control balloon	explod(t)=0;  end;    for b=1:length(trial_info(t).resp),      if bl(t)==3,            control_times(control_ctr)=trial_info(t).rt(b,1);            control_ctr=control_ctr+1;            continue;      end;      if trial_info(t).resp{b}==accept_resp,            accept_times(accept_ctr)=trial_info(t).rt(b,1);            accept_ctr=accept_ctr+1;      else,          reject_times(reject_ctr)=trial_info(t).rt(b,1);          reject_ctr=reject_ctr+1;      end;  end;  if explod(t)==1,      explode_times(explode_ctr)=trial_info(t).explode_time;      explode_ctr=explode_ctr+1;  end;          end;fprintf('balloon\tN(NoExp)\tE(expl)\tNexpl\tNpress\tMeanTotal\tMeanExplodeTrial\n');for b=1:3,    trials=find(bl==b & ~explod);    exp_trials=find(bl==b & explod);    explosions=length(find(bl==b & explod));    npress_mean(b)=mean(npress(trials));	if ~isempty(exp_trials),		npress_exp_mean(b)=mean(npress(exp_trials));	else,		npress_exp_mean(b)=0;	end;    tt_mean(b)=mean(tt(trials));    mean_et=mean(et(find(bl==b)));    fprintf('%d\t%d\t\t%d\t%d\t%0.3f\t%0.3f\t\t%0.1f\n',...	b,length(trials),explode_trial_dist(b),...	explosions,npress_mean(b),tt_mean(b),mean_et); end;% make onset files% acceptfid=fopen(sprintf('%s_run%d_accept_ons.txt',subject_initials,run_number),'w');for x=1:length(accept_times),    fprintf(fid,'%0.3f\t3\t1\n',accept_times(x));end;fclose(fid);% rejectfid=fopen(sprintf('%s_run%d_reject_ons.txt',subject_initials,run_number),'w');for x=1:length(reject_times),    fprintf(fid,'%0.3f\t3\t1\n',reject_times(x));end;fclose(fid);% explodefid=fopen(sprintf('%s_run%d_explode_ons.txt',subject_initials,run_number),'w');for x=1:length(explode_times),    fprintf(fid,'%0.3f\t3\t1\n',explode_times(x));end;fclose(fid);% controlfid=fopen(sprintf('%s_run%d_control_ons.txt',subject_initials,run_number),'w');for x=1:length(control_times),    fprintf(fid,'%0.3f\t3\t1\n',control_times(x));end;fclose(fid);